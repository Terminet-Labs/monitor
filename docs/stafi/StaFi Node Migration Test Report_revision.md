### StaFi Node Migration Test Report



**Test Environment：stafi seiya testnet**

**Test Configuration：host A：original node host**

​					**host B：Newly migrated node host**

**Test Premise：deploy a node on host A, and the validator has entered the active set**

**Application Scenarios：fast recovery in case of node host change and original node host failure**

----

##### **Scene One:**

###### **Introduce**

Node B synchronizes new node data, using node A's session key.

###### **Steps**

1、After waiting for the block height of Node B to be consistent with the browser block height, you can stop the process of node A.

2、Copy the session key file of node A to the host of node B.

3、Observe browser validator status.

###### **Test Results**

Nodes and validators are functioning normally.

----

##### **Scene Two:**

###### **Introduce**

Node B uses node A's session key to synchronize new node data.

###### **Steps**

1、After waiting for the block height of Node B to be consistent with the browser block height, stop the process of node A.

2、Copy the session key file of node A to node B and restart the process of node B.

3、Observe browser validator status.

###### **Test Results**

Nodes and validators are functioning normally.

----

##### **Scene Three:**

###### **Introduce**

Node B reuses node A's data, including node A's session key.

###### **Steps**

1、Copy the data of node A to node B, including the session key file of node A.

2、Stop the process of node A and start the process of node B.

3、Observe browser validator status.

###### **Test Results**

Nodes and validators are functioning normally.

----

##### **Scenario Four:**

###### **Introduce**

Node B synchronizes the new node data and generates a new session key.

###### **Steps**

1、After waiting for the block height of Node B to be consistent with the browser block height, generate a new session key.

2、<u>In the browser https://apps.stafi.io/</u> (<font color='red'>Open https://apps.stafi.io/ in your browser</font>), replace the validator's session key with the newly generated session key of Node B.

3、Observe browser validator status.

###### **Test Results**

The modified session key takes effect in the next period（ <u>Mainnet:a period of one hour,an era 6 hours. Testnet: a period of ten minutes,an epoch one hour</u>）(<font color='red'>Mainnet: An epoch is 1 hour, an era is 6 hours. Testnet: An epoch is ten minutes, an era is one hour</font>)；Delete the session key file of node A, and the process of node A will exit，Since Node B is running normally, nodes and validators will not be affected and will still function normally.

-----

##### **Scenario Five:**

###### **Introduce**

Node B synchronizes the new node data, generates a new session key, and stops the node A process.

###### **Steps**

1、After waiting for the block height of Node B to be consistent with the browser block height, generate new session key.

2、Stop the process of node A, <u>In the browser https://apps.stafi.io/ Replace the validator's session key with the session key generated by Node B.</u>(<font color='red'>replace the validator's session key with the one generated by Node B in the browser https://apps.stafi.io/</font>)

3、Observe browser validator status.

###### **Test Results**

Nodes and validators operate normally, and the modified session key takes effect in the next epoch.

---

##### **Scenario Six:**

###### **Introduce**

Node B reuses the data of node A, including the session key of node A, and node A keeps processing.

###### **Steps**

1、Copy the data of node A to node B, including the key file of node A.

2、Start the process of node B, node A does not operate.

3、Observe browser validator status.

###### **Test Results**

Validators are penalized.

-------

##### **Scenario Seven:**

###### **Introduce**

Node B synchronizes new data, using node A's session key, node A keeps progressing.

###### **<font color='red'>Steps</font>**

1、After waiting for the block height of Node B to be consistent with the browser block height, Copy the session key file of node A to node B.

2、Node A does nothing.

3、Observe browser validator status.

###### **Test Results**

Validators are penalized.

------

#### Test Conclusion:

- Node salsh trigger condition: 1）More than 1/10 of the nodes in the entire network are offline at the same time.

  ​									2）The same key runs on multiple nodes at the same time.

- There are too few validators on the test network, and the node stop time should be as short as possible during migration;There is only a 1/160 chance that a single node of the main network will be offline. If the total offline nodes do not reach 1/10, they will not be penalized.

- Whether or not the process is restarted after the node is migrated has no effect on the node, but the deletion of the session key will cause the node to exit.

- It is the session key that the node migration affects the validator: <u>Can reuse the old session key or generate a new session key and modify the binding on the validator</u>(<font color='red'>the old session key can be reused, or a new session key can be generated and the binding can be modified on the validator</font>font>).

- **The best migration solution: prepare a new node that has completed synchronization, in the browser https://apps.stafi.io/ change the validator's session key to the new node's session key.**

  

